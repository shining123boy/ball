var ball=function(e){function t(t,i,s,h){e.call(this),this.colors=[3581109,16741235,16759296,4637287,14371659,8704667,12155479,10701220,11920925,16744231],this.drawball(t,i,s,h)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.drawLine=function(){var e=new egret.Shape;e.graphics.lineStyle(2,0),e.graphics.moveTo(0,0),e.x=this.x,e.y=this.y,e.graphics.lineTo(this.x,200),e.graphics.endFill(),this.addChild(e)},s.drawball=function(e,t,i,s){var h=new egret.Shape;h.graphics.beginFill(this.colors[s],1),h.graphics.drawCircle(e,t,i),h.graphics.endFill(),this.addChild(h);var a=new egret.TextField;a.textColor=16777215,a.width=24,a.textAlign="center",a.text=s+1+"",a.size=15,a.x=h.x-a.width/2,a.y=h.y-a.height/2,this.addChild(a),this.color=this.colors[s],this.number=a.text},s.getName=function(){return this.ballName},s.setName=function(e){this.ballName=e},s.getColor=function(){return this.color},s.getNumber=function(){return this.number},t}(egret.Sprite);egret.registerClass(ball,"ball");var Level=function(e){function t(t){e.call(this),2>t?(this.basicLine=3,this.baseball=3):3>t?(this.basicLine=4,this.baseball=4):4>t?(this.basicLine=5,this.baseball=5):5>t?(this.basicLine=5,this.baseball=6):6>t?(this.basicLine=5,this.baseball=7):7>t?(this.basicLine=5,this.baseball=8):20>t&&(this.basicLine=5,this.baseball=9),t%2==0?this.rotateDirection=!1:this.rotateDirection=!0}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setBasicLine=function(e){this.basicLine=e},s.getBasicLine=function(){return this.basicLine},s.getBaseball=function(){return this.baseball},s.getRotateDirection=function(){return this.rotateDirection},t}(egret.DisplayObject);egret.registerClass(Level,"Level");var Line=function(e){function t(t,i,s,h){e.call(this),this.drawColorball(t,i,s,h)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.getAngle=function(){return this.$getRotation().valueOf()},s.drawColorball=function(e,t,i,s){var h=new egret.Shape;h.graphics.lineStyle(2,i),h.graphics.moveTo(0,0),h.graphics.lineTo(e,t),h.graphics.endFill(),this.addChild(h);var a=new egret.Shape;if(a.graphics.beginFill(i,1),a.graphics.drawCircle(e,t,12),a.graphics.endFill(),this.addChild(a),"0"!=s){var r=new egret.TextField;r.textColor=16777215,r.width=24,r.textAlign="center",r.text=s,r.size=15,r.x=e-r.width/2,r.y=t-r.height/2,this.addChild(r)}},s.drawLineWithParams=function(e,t,i,s){var h=new egret.Shape;h.graphics.lineStyle(2,0),h.graphics.moveTo(0,0),h.graphics.lineTo(i,s),h.graphics.endFill(),this.addChild(h);var a=new egret.Shape;a.graphics.beginFill(0,1),a.graphics.drawCircle(i,s,10),a.graphics.endFill(),this.addChild(a)},s.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},s.getSx=function(){return this.sx},s.getSy=function(){return this.sy},s.getEx=function(){return this.ex},s.getEy=function(){return this.ey},s.getX=function(){return this.$getX()},t}(egret.Sprite);egret.registerClass(Line,"Line");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.radius=120,this.lines=new Array,this.balls=new Array,this.shotBalls=new Array,this.is_twBall_arr=new Array,this.speed=5e3,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.speedTimerFunc=function(){this.speed=Math.floor(5e3*Math.random())+3e3,this.rotateAll(this.speed)},s.timerComFunc=function(){console.log("计时结束")},s.createGameScene=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight,i=egret.localStorage.getItem("play_station");this.levelNum=parseInt(i),this.levelNum>=20&&alert("闯关成功！"),(void 0==i||""==i)&&(this.levelNum=1);var s=new Level(this.levelNum);this.basicLine=s.getBasicLine(),this.baseball=s.getBaseball(),this.rotateDirection=s.getRotateDirection();var h=this.createBitmapByName("ball_bg_png");this.addChild(h);var a=!1;if(!a){h.width=e,h.height=t,this.scoreLabel=new egret.TextField,this.scoreLabel.textColor=0,this.scoreLabel.width=200,this.scoreLabel.textAlign="left";var r=egret.localStorage.getItem("score");void 0!=r&&""!=r?this.score=parseInt(r):this.score=0,this.scoreLabel.text="积分:"+this.score,this.scoreLabel.fontFamily="微软雅黑",this.scoreLabel.size=24,this.scoreLabel.x=20,this.scoreLabel.y=30,this.addChild(this.scoreLabel);var n=this.createBitmapByName("menu_png");this.addChild(n),n.touchEnabled=!0,this.isMenuOpen=!1,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.isMenuOpen||(e.stopImmediatePropagation(),this.createMenuItem(),this.isMenuOpen=!0)},this),n.x=e-180,n.y=20;var l=new egret.TextField;l.textColor=16777215,l.width=100,l.height=25,l.textAlign="center",l.text="菜单",l.fontFamily="微软雅黑",l.size=25,l.x=n.x+(n.width-100)/2,l.y=n.y+(n.height-25)/2,this.addChild(l),this.drawBaseLine(),this.rotateAll(5e3),this.speedTimer=new egret.Timer(2e3,0),this.speedTimer.addEventListener(egret.TimerEvent.TIMER,this.speedTimerFunc,this),this.speedTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.speedTimer.start(),this.addCircleYellow(),this.initBalls(),this.touchEnabled=!0,this.isShowMenu=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isShowMenu&&this.shotBall()},this)}},s.rotateAll=function(e){for(var t=0;t<this.lines.length;t++){egret.Tween.removeTweens(this.lines[t]);var i,s=egret.Tween.get(this.lines[t],{loop:!0});i=this.rotateDirection?1:-1,s.to({rotation:this.lines[t].getAngle()+360*i},e)}},s.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},s.rotateLine=function(e,t){var i=0,s=0;Math.cos(t)*this.radius+i,Math.sin(t)*this.radius+s},s.shotBall=function(){if(this.balls.length>0){this.is_twBall_arr.push(!0);var e=this.balls.pop();this.shotBalls.push(e),e.touchEnabled=!0;for(var t=0;t<this.balls.length;t++)this.balls[t].y-=30;var i=egret.Tween.get(e);i.to({y:this.circleY+120},200),i.call(function(){this.is_twBall_arr.pop();for(var t=0;t<this.lines.length;t++){var i=this.lines[t].getAngle();if(Math.abs(i)<11.3){egret.Tween.removeAllTweens(),this.touchEnabled=!1,this.speedTimer.stop();var s=new egret.Timer(1e3,1);return s.addEventListener(egret.TimerEvent.TIMER,this.loseMenu,this),void s.start()}}this.removeChild(e);var h=new Line(0,120,e.getColor(),e.getNumber());if(h.x=this.circleX,h.y=this.circleY,this.addChild(h),this.addCircleYellow(),this.lines.push(h),this.rotateAll(this.speed),0==this.balls.length&&0==this.is_twBall_arr.length){this.speedTimer.stop(),egret.Tween.removeAllTweens();for(var a,t=0;t<this.lines.length;t++)a=egret.Tween.get(this.lines[t],{loop:!0}),a.to({rotation:this.lines[t].getAngle()+360},500);var r=new egret.Timer(2e3,1);r.addEventListener(egret.TimerEvent.TIMER,this.nextLevel,this),r.start(),this.addScore()}},this,[this.lines])}},s.nextLevel=function(){var e=new MenuBg;this.addChild(e),egret.Tween.removeAllTweens();var t=this.createBitmapByName("res_suc_png");this.addChild(t),t.width=.6*this.stage.width,t.height=.4*this.stage.height,t.x=this.stage.width/2-t.width/2,t.y=this.stage.height/2-t.height/2;var i=this.createBitmapByName("nextlevel");this.addChild(i),i.width=.8*t.width,i.height=i.width/3.3,i.x=this.stage.width/2-i.width/2,i.y=this.stage.height/2-i.height/2,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(s){s.stopImmediatePropagation(),this.removeChild(i),this.removeChild(t),this.removeChild(e);for(var h=0;h<this.lines.length;h++)this.removeChild(this.lines[h]);this.lines.length=0;for(var h=0;h<this.balls.length;h++)this.removeChild(this.balls[h]);this.balls.length=0,this.shotBalls.length=0,this.is_twBall_arr.length=0,this.levelNum++,egret.localStorage.setItem("play_station",this.levelNum+""),this.levelNum>=20&&alert("闯关成功！");var a=new Level(this.levelNum);this.basicLine=a.getBasicLine(),this.baseball=a.getBaseball(),this.rotateDirection=a.getRotateDirection(),this.drawBaseLine(),this.rotateAll(5e3),this.addCircleYellow(),this.initBalls()},this)},s.loseMenu=function(){var e=new MenuBg;this.addChild(e);var t=this.createBitmapByName("res_fail_png");e.addChild(t),t.width=.6*this.stage.width,t.height=.4*this.stage.height,t.x=this.stage.width/2-t.width/2,t.y=this.stage.height/2-t.height/2;var i=this.createBitmapByName("redo_png");e.addChild(i),i.width=.8*t.width,i.height=i.width/3.3,i.x=this.stage.width/2-i.width/2,i.y=this.stage.height/2-i.height/2,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stopImmediatePropagation(),this.removeChild(e);for(var i=0;i<this.lines.length;i++)this.removeChild(this.lines[i]);this.lines.length=0;for(var i=0;i<this.balls.length;i++)this.removeChild(this.balls[i]);this.balls.length=0;for(var i=0;i<this.shotBalls.length;i++)this.contains(this.shotBalls[i])&&this.removeChild(this.shotBalls[i]);this.shotBalls.length=0,this.is_twBall_arr.length=0,this.drawBaseLine(),this.addCircleYellow(),this.rotateAll(5e3),this.initBalls(),this.touchEnabled=!0,this.speedTimer.start()},this)},s.initBalls=function(){for(var e=this.stage.stageWidth,t=this.stage.stageHeight,i=e/2,s=1;s<this.baseball;s++){var h=new ball(0,0,12,s-1);h.x=i,this.baseball<6?h.y=t-30*s:h.y=t-30*s+30*(this.baseball-5),h.setName("ball"+s),this.addChild(h),this.balls.push(h)}},s.addCircleYellow=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.circleX=e/2,this.circleY=2*t/5;var i=new egret.Shape;i.graphics.beginFill(16759296,1),i.graphics.drawCircle(this.circleX,this.circleY,50),i.graphics.endFill(),this.addChild(i);var s=new egret.TextField;s.textColor=16777215,s.width=100,s.textAlign="center",s.text=this.levelNum+"",s.size=40,s.x=this.circleX-s.width/2,s.y=this.circleY-s.height/2,this.addChild(s)},s.drawBaseLine=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.circleX=e/2,this.circleY=2*t/5;for(var i=0;i<this.basicLine;i++){var s=new Line(0,120,0,"0");s.x=this.circleX,s.y=this.circleY,s.rotation=i*(360/this.basicLine),this.addChild(s),this.lines.push(s)}},s.addScore=function(){var e=new egret.TextField;e.textColor=0,e.width=200,e.textAlign="left",e.text="+200",e.size=24,e.x=360,e.y=230,this.addChild(e),this.score+=200;egret.Tween.get(e).to({x:100,y:30,alpha:0},1e3,egret.Ease.sineIn).call(function(){this.scoreLabel.text="积分:"+this.score,egret.localStorage.setItem("score",this.score)},this)},s.createMenuItem=function(){var e=new MenuBg;this.addChild(e);var t=this.createBitmapByName("menulayer_bg_png");t.width=.7*this.stage.width,t.height=.6*this.stage.height,t.x=this.stage.width/2-t.width/2,t.y=this.stage.height/2-2*t.height/3,e.addChild(t),this.isShowMenu=!1;var i=this.createBitmapByName("menuItem");i.width=200,i.height=50,i.x=this.stage.width/2-i.width/2,i.y=t.y+10+t.height/5,e.addChild(i);var s=new egret.TextField;s.width=150,s.height=24,s.x=this.stage.width/2-s.width/2,s.y=i.y+14,s.text="重新挑战",s.fontFamily="微软雅黑",s.size=24,s.textAlign="center",e.addChild(s),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stopImmediatePropagation(),this.removeChild(e);for(var i=0;i<this.lines.length;i++)this.removeChild(this.lines[i]);this.lines.length=0;for(var i=0;i<this.balls.length;i++)this.removeChild(this.balls[i]);this.balls.length=0,this.shotBalls.length=0,this.drawBaseLine(),this.addCircleYellow(),this.rotateAll(5e3),this.initBalls(),this.isShowMenu=!0,this.isMenuOpen=!1},this);var h=this.createBitmapByName("menuItem");h.width=200,h.height=50,h.x=this.stage.width/2-i.width/2,h.y=t.y+10+2*t.height/5,e.addChild(h);var s=new egret.TextField;s.width=150,s.height=24,s.x=this.stage.width/2-s.width/2,s.y=h.y+14,s.text="我的记录",s.size=24,s.fontFamily="微软雅黑",s.textAlign="center",e.addChild(s),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stopImmediatePropagation(),this.removeChild(e),this.isShowMenu=!0,this.isMenuOpen=!1},this);var a=this.createBitmapByName("menuItem");a.width=200,a.height=50,a.x=this.stage.width/2-i.width/2,a.y=t.y+10+3*t.height/5,e.addChild(a);var s=new egret.TextField;s.width=150,s.height=24,s.x=this.stage.width/2-s.width/2,s.y=a.y+14,s.text="排行榜",s.fontFamily="微软雅黑",s.size=24,s.textAlign="center",e.addChild(s),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stopImmediatePropagation(),this.removeChild(e),this.isShowMenu=!0,this.isMenuOpen=!1},this);var r=this.createBitmapByName("menuItem");r.width=200,r.height=50,r.x=this.stage.width/2-i.width/2,r.y=t.y+10+4*t.height/5,e.addChild(r);var s=new egret.TextField;s.width=150,s.height=24,s.x=this.stage.width/2-s.width/2,s.y=r.y+14,s.text="退出游戏",s.size=24,s.fontFamily="微软雅黑",s.textAlign="center",e.addChild(s),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stopImmediatePropagation(),this.removeChild(e),this.isShowMenu=!0,this.isMenuOpen=!1},this)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var MenuBg=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){var t=new egret.Shape;t.graphics.beginFill(0,.6),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),this.addChild(t)},t}(egret.DisplayObjectContainer);egret.registerClass(MenuBg,"MenuBg");var Numball=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.getAngle=function(){return this.$getRotation().valueOf()},s.drawNumball=function(e,t){var i=new egret.Shape;i.graphics.lineStyle(2,0),i.graphics.moveTo(0,0),i.graphics.lineTo(e,t),i.graphics.endFill(),this.addChild(i);var s=new egret.Shape;s.graphics.beginFill(0,1),s.graphics.drawCircle(e,t,10),s.graphics.endFill(),this.addChild(s)},t}(egret.Sprite);egret.registerClass(Numball,"Numball");var Test=function(e){function t(){e.call(this);var t=this.createBitmapByName("ball_bg_png");this.addChild(t);var i=this.stage.stageWidth,s=this.stage.stageHeight;t.width=i,t.height=s;var h=new egret.TextField;h.textColor=0,h.width=200,h.textAlign="left",h.text="大米：1450",h.size=24,h.x=20,h.y=30,this.addChild(h);var a=new egret.TextField;a.textColor=16777215,a.width=100,a.height=30,a.textAlign="center",a.text="菜单",a.size=24,a.x=i-120,a.y=30,a.background=!0,a.backgroundColor=15046656,this.addChild(a);var r=i/2,n=s/2-50,l=new egret.Shape;l.graphics.lineStyle(2,0),l.graphics.moveTo(r,n),l.graphics.lineTo(200,200),l.graphics.endFill();var o=egret.Tween.get(l);o.to({rotation:20},1e3);var d=new egret.Shape;d.x=200,d.y=200,d.graphics.beginFill(0,1),d.graphics.drawCircle(0,0,10),d.graphics.endFill(),this.addChild(d),this.drawNumberBall(r,n,50,"11"),d.graphics.drawCircle(0,0,10),d.graphics.endFill(),this.addChild(d),this.drawNumberBall(r,s-200,10,"8")}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},s.drawNumberBall=function(e,t,i,s){var h=new egret.Shape;h.x=e,h.y=t,h.graphics.beginFill(15046656,1),h.graphics.drawCircle(0,0,i),h.graphics.endFill(),this.addChild(h);var a=new egret.TextField;a.textColor=16777215,a.width=50,a.textAlign="center",a.text=s,50==i?a.size=26:10==i&&(a.size=14),a.x=h.x-a.width/2,a.y=h.y-a.height/2,this.addChild(a)},t}(egret.Sprite);egret.registerClass(Test,"Test");